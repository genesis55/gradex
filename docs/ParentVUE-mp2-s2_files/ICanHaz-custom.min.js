//This version of ICanHaz has been modified to load external templates.
(function(){var e=function(){function o(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return s[e]||e})}var e=Object.prototype.toString;Array.isArray=Array.isArray||function(t){return e.call(t)=="[object Array]"};var t=String.prototype.trim,n;if(t){n=function(e){return e==null?"":t.call(e)}}else{var r,i;if(/\S/.test(" ")){r=/^[\s\xA0]+/;i=/[\s\xA0]+$/}else{r=/^\s+/;i=/\s+$/}n=function(e){return e==null?"":e.toString().replace(r,"").replace(i,"")}}var s={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var u={};var a=function(){};a.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(e,t,n,r){if(!r){this.context=t;this.context.G=this.context.G||window;this.buffer=[]}if(!this.includes("",e)){if(r){return e}else{this.send(e);return}}e=this.render_pragmas(e);var i=this.render_section(e,t,n);if(i===false){i=this.render_tags(e,t,n,r)}if(r){return i}else{this.sendLines(i)}},send:function(e){if(e!==""){this.buffer.push(e)}},sendLines:function(e){if(e){var t=e.split("\n");for(var n=0;n<t.length;n++){this.send(t[n])}}},render_pragmas:function(e){if(!this.includes("%",e)){return e}var t=this;var n=this.getCachedRegex("render_pragmas",function(e,t){return new RegExp(e+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+t,"g")});return e.replace(n,function(e,n,r){if(!t.pragmas_implemented[n]){throw{message:"This implementation of mustache doesn't understand the '"+n+"' pragma"}}t.pragmas[n]={};if(r){var i=r.split("=");t.pragmas[n][i[0]]=i[1]}return""})},render_partial:function(e,t,r){e=n(e);if(!r||r[e]===undefined){throw{message:"unknown_partial '"+e+"'"}}if(!t||typeof t[e]!="object"){return this.render(r[e],t,r,true)}return this.render(r[e],t[e],r,true)},render_section:function(e,t,n){if(!this.includes("#",e)&&!this.includes("^",e)){return false}var r=this;var i=this.getCachedRegex("render_section",function(e,t){return new RegExp("^([\\s\\S]*?)"+e+"(\\^|\\#)\\s*(.+)\\s*"+t+"\n*([\\s\\S]*?)"+e+"\\/\\s*\\3\\s*"+t+"\\s*([\\s\\S]*)$","g")});return e.replace(i,function(e,i,s,o,u,a){var f=i?r.render_tags(i,t,n,true):"",l=a?r.render(a,t,n,true):"",c,h=r.find(o,t);if(s==="^"){if(!h||Array.isArray(h)&&h.length===0){c=r.render(u,t,n,true)}else{c=""}}else if(s==="#"){if(Array.isArray(h)){c=r.map(h,function(e){return r.render(u,r.create_context(e),n,true)}).join("")}else if(r.is_object(h)){c=r.render(u,r.create_context(h),n,true)}else if(typeof h=="function"){c=h.call(t,u,function(e){return r.render(e,t,n,true)})}else if(h){c=r.render(u,t,n,true)}else{c=""}}return f+c+l})},render_tags:function(e,t,n,r){var i=this;var s=function(){return i.getCachedRegex("render_tags",function(e,t){return new RegExp(e+"(=|!|>|&|\\{|%)?([^#\\^]+?)\\1?"+t+"+","g")})};var u=s();var a=function(e,r,a){switch(r){case"!":return"";case"=":i.set_delimiters(a);u=s();return"";case">":return i.render_partial(a,t,n);case"{":case"&":return i.find(a,t);default:return o(i.find(a,t))}};var f=e.split("\n");for(var l=0;l<f.length;l++){f[l]=f[l].replace(u,a,this);if(!r){this.send(f[l])}}if(r){return f.join("\n")}},set_delimiters:function(e){var t=e.split(" ");this.otag=this.escape_regex(t[0]);this.ctag=this.escape_regex(t[1])},escape_regex:function(e){if(!arguments.callee.sRE){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+t.join("|\\")+")","g")}return e.replace(arguments.callee.sRE,"\\$1")},find:function(e,t){function r(e){return e===false||e===0||e}e=n(e);var i;if(e.match(/([a-z_]+)\./ig)){var s=this.walk_context(e,t);if(r(s)){i=s}}else{if(r(t[e])){i=t[e]}else if(r(this.context[e])){i=this.context[e]}}if(typeof i=="function"){return i.apply(t)}if(i!==undefined){return i}return""},walk_context:function(e,t){var n=e.split(".");var r=t[n[0]]!=undefined?t:this.context;var i=r[n.shift()];while(i!=undefined&&n.length>0){r=i;i=i[n.shift()]}if(typeof i=="function"){return i.apply(r)}return i},includes:function(e,t){return t.indexOf(this.otag+e)!=-1},create_context:function(e){if(this.is_object(e)){return e}else{var t=".";if(this.pragmas["IMPLICIT-ITERATOR"]){t=this.pragmas["IMPLICIT-ITERATOR"].iterator}var n={};n[t]=e;return n}},is_object:function(e){return e&&typeof e=="object"},map:function(e,t){if(typeof e.map=="function"){return e.map(t)}else{var n=[];var r=e.length;for(var i=0;i<r;i++){n.push(t(e[i]))}return n}},getCachedRegex:function(e,t){var n=u[this.otag];if(!n){n=u[this.otag]={}}var r=n[this.ctag];if(!r){r=n[this.ctag]={}}var i=r[e];if(!i){i=r[e]=t(this.otag,this.ctag)}return i}};return{name:"mustache.js",version:"0.4.0",to_html:function(e,t,n,r){var i=new a;if(r){i.send=r}i.render(e,t||{},n);if(!r){return i.buffer.join("\n")}}}}();(function(){function t(e){if("".trim)return e.trim();else return e.replace(/^\s+/,"").replace(/\s+$/,"")}var n=this;var r={VERSION:"0.10.2",templates:{},$:typeof window!=="undefined"?window.jQuery||window.Zepto||null:null,addTemplate:function(n,i){if(typeof n==="object"){for(var s in n){this.addTemplate(s,n[s])}return}if(r[n]){console.error("Invalid name: "+n+".")}else if(r.templates[n]){console.error('Template "'+n+'  " exists')}else{r.templates[n]=i;r[n]=function(i,s){i=i||{};var o=e.to_html(r.templates[n],i,r.templates);return r.$&&!s?r.$(t(o)):o}}},clearAll:function(){for(var e in r.templates){delete r[e]}r.templates={}},refresh:function(){r.clearAll();r.grabTemplates()},grabTemplates:function(){var e,n,i=document.getElementsByTagName("script"),s,o=[];for(e=0,n=i.length;e<n;e++){s=i[e];if(s&&s.innerHTML&&s.id&&(s.type==="text/html"||s.type==="text/x-icanhaz")){r.addTemplate(s.id,t(s.innerHTML));o.unshift(s)}}for(e=0,n=o.length;e<n;e++){o[e].parentNode.removeChild(o[e])}}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=r}exports.ich=r}else{n["ich"]=r}if(typeof document!=="undefined"){if(r.$){r.$(function(){r.grabTemplates()})}else{document.addEventListener("DOMContentLoaded",function(){r.grabTemplates()},true)}}})()})()